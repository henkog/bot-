<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Stake Elite TG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f212e; --card: #1a2c38; --green: #00e701;
            --blue: #2f4553; --text: #b1bad3; --gold: #fbc531;
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: manipulation; }
        body { 
            background: var(--bg); color: white; font-family: 'Inter', sans-serif;
            margin: 0; display: flex; flex-direction: column; height: 100vh;
        }

        /* HEADER & XP BAR */
        .header { padding: 10px 15px; background: var(--card); border-bottom: 2px solid #213743; }
        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .wallet { background: #071824; padding: 5px 12px; border-radius: 4px; font-weight: bold; border: 1px solid #2f4553; }
        .xp-bar { width: 100%; height: 4px; background: #071824; border-radius: 2px; overflow: hidden; }
        .xp-progress { height: 100%; background: var(--green); width: 45%; transition: 0.5s; }

        /* CONTENT */
        .viewport { flex: 1; position: relative; overflow-y: auto; padding: 15px; }
        .game-view { display: none; flex-direction: column; gap: 20px; align-items: center; }
        .game-view.active { display: flex; }

        /* LIMBO STYLE */
        .limbo-display { font-size: 4rem; font-weight: 900; color: var(--gold); margin: 40px 0; text-shadow: 0 0 20px rgba(251,197,49,0.3); }

        /* TOWER STYLE */
        .tower-grid { display: grid; grid-template-rows: repeat(8, 1fr); gap: 5px; width: 100%; max-width: 250px; }
        .tower-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; opacity: 0.5; pointer-events: none; }
        .tower-row.active { opacity: 1; pointer-events: auto; }
        .tower-cell { height: 40px; background: var(--blue); border-radius: 4px; display: flex; align-items: center; justify-content: center; }

        /* STAKE CONTROLS */
        .control-panel { background: var(--card); padding: 15px; border-radius: 8px; width: 100%; margin-top: auto; }
        .input-group { background: #071824; border: 2px solid #2f4553; border-radius: 4px; display: flex; align-items: center; padding: 8px; margin-bottom: 10px; }
        .input-group input { background: transparent; border: none; color: white; flex: 1; font-weight: bold; outline: none; }
        .bet-btn { 
            width: 100%; background: var(--green); color: #000; border: none; padding: 15px; 
            border-radius: 4px; font-weight: 800; text-transform: uppercase; transition: 0.1s;
        }
        .bet-btn:active { transform: scale(0.98); }

        /* NAV */
        .footer-nav { display: flex; background: var(--card); padding: 10px 0 30px; border-top: 1px solid #213743; }
        .nav-tab { flex: 1; text-align: center; color: var(--text); font-size: 0.7rem; font-weight: bold; cursor: pointer; }
        .nav-tab.active { color: white; }
        .nav-tab span { display: block; font-size: 1.4rem; margin-bottom: 2px; }
    </style>
</head>
<body>

<div class="header">
    <div class="top-row">
        <div style="font-size: 0.8rem; font-weight: 800; color: var(--green);">STAKE ELITE</div>
        <div class="wallet" id="wallet-val">0.00 üí∞</div>
    </div>
    <div class="xp-bar"><div class="xp-progress" id="xp-fill"></div></div>
</div>

<div class="viewport">
    <div id="game-limbo" class="game-view active">
        <div class="limbo-display" id="limbo-res">1.00x</div>
        <div class="control-panel">
            <div class="label" style="font-size: 0.7rem; color: var(--text); margin-bottom: 5px;">TARGET MULTIPLIER</div>
            <div class="input-group">
                <input type="number" id="limbo-target" value="2.00" step="0.1">
                <span style="color: var(--text)">√ó</span>
            </div>
            <button class="bet-btn" onpointerdown="playLimbo()">Bet</button>
        </div>
    </div>

    <div id="game-tower" class="game-view">
        <div id="tower-x" style="font-size: 1.5rem; font-weight: bold; color: var(--green);">X 1.00</div>
        <div class="tower-grid" id="tower-board"></div>
        <div class="control-panel">
            <button class="bet-btn" id="tower-action" onpointerdown="startTower()">Start Game</button>
        </div>
    </div>
</div>

<div class="footer-nav">
    <div class="nav-tab active" onpointerdown="switchGame('limbo', this)"><span>üöÄ</span>LIMBO</div>
    <div class="nav-tab" onpointerdown="switchGame('tower', this)"><span>üè∞</span>TOWER</div>
    <div class="nav-tab" onpointerdown="tg.close()"><span>üö™</span>EXIT</div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    let balance = parseFloat(new URLSearchParams(window.location.search).get('bal')) || 1000;
    let xp = 45;
    
    function updateUI() {
        document.getElementById('wallet-val').innerText = balance.toFixed(2) + ' üí∞';
        document.getElementById('xp-fill').style.width = xp + '%';
    }
    updateUI();

    function switchGame(game, el) {
        document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('game-' + game).classList.add('active');
        el.classList.add('active');
        tg.HapticFeedback.selectionChanged();
    }

    // --- LIMBO LOGIC ---
    function playLimbo() {
        if(balance < 100) return;
        const target = parseFloat(document.getElementById('limbo-target').value);
        const display = document.getElementById('limbo-res');
        
        let result = (Math.random() * 10).toFixed(2); // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —à–∞–Ω—Å
        let count = 1.00;
        let speed = 20;

        let anim = setInterval(() => {
            count += 0.05;
            display.innerText = count.toFixed(2) + 'x';
            if(count >= result) {
                clearInterval(anim);
                display.style.color = result >= target ? 'var(--green)' : '#ff4757';
                finishGame('limbo', result >= target ? Math.floor(100 * target) : 0);
            }
        }, speed);
    }

    // --- TOWER LOGIC ---
    let towerLevel = 0;
    function startTower() {
        const board = document.getElementById('tower-board');
        board.innerHTML = '';
        towerLevel = 7;
        for(let i=0; i<8; i++) {
            let row = document.createElement('div');
            row.className = 'tower-row' + (i === 7 ? ' active' : '');
            row.id = 'row-' + i;
            for(let j=0; j<3; j++) {
                let cell = document.createElement('div');
                cell.className = 'tower-cell';
                cell.onpointerdown = () => chooseTower(i, j, cell);
                row.appendChild(cell);
            }
            board.appendChild(row);
        }
        document.getElementById('tower-action').innerText = 'Cashout';
    }

    function chooseTower(rowIdx, cellIdx, el) {
        let isMine = Math.random() < 0.3;
        if(isMine) {
            el.innerText = 'üí£'; el.style.background = '#ff4757';
            finishGame('tower', 0);
        } else {
            el.innerText = 'üíé'; el.style.background = 'var(--green)';
            document.getElementById('row-'+towerLevel).classList.remove('active');
            towerLevel--;
            if(towerLevel >= 0) document.getElementById('row-'+towerLevel).classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }
    }

    function finishGame(game, win) {
        balance = balance - 100 + win;
        xp += 2;
        updateUI();
        tg.HapticFeedback.notificationOccurred(win > 0 ? 'success' : 'error');
        setTimeout(() => {
            tg.sendData(JSON.stringify({ game, amount: win }));
        }, 1000);
    }
</script>
</body>
</html>
