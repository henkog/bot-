<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cyber Casino Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #00d4ff; --pink: #ff00ff; --gold: #fbc531; --bg: #05060a; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: manipulation; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .header { padding: 15px 20px; display: flex; justify-content: space-between; background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--neon); }
        #p-bal { color: var(--gold); font-size: 1.4rem; font-weight: bold; }

        .game-container { flex: 1; position: relative; }
        .game-card { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .game-card.active { display: flex; }

        /* –°–ê–ü–ï–† */
        .mines-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 280px; }
        .cell { width: 60px; height: 60px; background: #1a1a1a; border-radius: 8px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .cell.open { background: #222; border-color: var(--neon); }
        .cell.mine { background: #ff4757; }
        .x-display { margin-bottom: 15px; font-size: 1.5rem; color: var(--pink); font-weight: bold; }

        /* –°–õ–û–¢–´ */
        .slot-box { display: flex; gap: 8px; background: #000; padding: 15px; border-radius: 15px; border: 2px solid var(--neon); }
        .slot { width: 70px; height: 90px; background: #111; display: flex; align-items: center; justify-content: center; font-size: 3rem; border-radius: 10px; }

        /* –ö–ù–û–ü–ö–ò (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ) */
        .btn { 
            width: 80%; padding: 18px; border: none; border-radius: 15px; background: linear-gradient(45deg, var(--neon), var(--pink));
            color: white; font-weight: bold; font-size: 1.1rem; cursor: pointer;
            transition: transform 0.05s; pointer-events: auto;
        }
        .btn:active { transform: scale(0.95); opacity: 0.8; }

        .nav { display: flex; background: #000; padding: 10px 0 25px; border-top: 1px solid #222; }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 0.7rem; }
        .nav-item.active { color: var(--neon); }
        .nav-icon { font-size: 1.4rem; display: block; }
    </style>
</head>
<body>

<div class="header">
    <div id="p-name">PILOT</div>
    <div id="p-bal">0</div>
</div>

<div class="game-container">
    <div id="slots" class="game-card active">
        <div class="slot-box">
            <div id="sl1" class="slot">üíé</div>
            <div id="sl2" class="slot">üíé</div>
            <div id="sl3" class="slot">üíé</div>
        </div>
        <button class="btn" id="spin-btn" onpointerdown="playSlots()">–ö–†–£–¢–ò–¢–¨ (100)</button>
    </div>

    <div id="mines" class="game-card">
        <div class="x-display">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="mine-x">1.00</span>x</div>
        <div class="mines-grid" id="mine-grid"></div>
        <button class="btn" style="margin-top:20px; background:var(--gold); color:black;" id="cashout-btn" onpointerdown="mineCashout()" disabled>–ó–ê–ë–†–ê–¢–¨</button>
        <button class="btn" style="margin-top:10px;" id="mine-start" onpointerdown="startMines()">–ò–ì–†–ê–¢–¨ (100)</button>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onpointerdown="switchGame('slots')"><span class="nav-icon">üé∞</span>Slots</div>
    <div class="nav-item" onpointerdown="switchGame('mines')"><span class="nav-icon">üí£</span>Mines</div>
    <div class="nav-item" onpointerdown="tg.close()"><span class="nav-icon">üö™</span>Exit</div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    const urlParams = new URLSearchParams(window.location.search);
    let balance = parseInt(urlParams.get('bal')) || 1000;
    document.getElementById('p-bal').innerText = balance;

    function switchGame(id) {
        document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        tg.HapticFeedback.selectionChanged();
    }

    // --- SLOTS ---
    function playSlots() {
        if(balance < 100) return;
        tg.HapticFeedback.impactOccurred('medium');
        let spins = 0;
        let t = setInterval(() => {
            const s = ['üíé','7Ô∏è‚É£','üçí','üçã'];
            document.getElementById('sl1').innerText = s[Math.floor(Math.random()*4)];
            document.getElementById('sl2').innerText = s[Math.floor(Math.random()*4)];
            document.getElementById('sl3').innerText = s[Math.floor(Math.random()*4)];
            if(spins++ > 15) {
                clearInterval(t);
                let win = document.getElementById('sl1').innerText === document.getElementById('sl2').innerText && document.getElementById('sl2').innerText === document.getElementById('sl3').innerText;
                finishGame('slots', win ? 'win' : 'loss', win ? 600 : 0);
            }
        }, 70);
    }

    // --- MINES LOGIC ---
    let mineGame = { active: false, x: 1.0, mines: [], opened: 0 };
    function startMines() {
        if(balance < 100) return;
        mineGame = { active: true, x: 1.0, mines: [], opened: 0 };
        document.getElementById('mine-grid').innerHTML = '';
        document.getElementById('mine-x').innerText = '1.00';
        document.getElementById('cashout-btn').disabled = true;
        document.getElementById('mine-start').disabled = true;
        
        // –°–æ–∑–¥–∞–µ–º 3 –º–∏–Ω—ã –Ω–∞ 16 –∫–ª–µ—Ç–æ–∫
        while(mineGame.mines.length < 3) {
            let r = Math.floor(Math.random() * 16);
            if(!mineGame.mines.includes(r)) mineGame.mines.push(r);
        }

        for(let i=0; i<16; i++) {
            let cell = document.createElement('div');
            cell.className = 'cell';
            cell.onpointerdown = () => openCell(i, cell);
            document.getElementById('mine-grid').appendChild(cell);
        }
    }

    function openCell(idx, el) {
        if(!mineGame.active || el.classList.contains('open')) return;
        if(mineGame.mines.includes(idx)) {
            el.innerText = 'üí£';
            el.classList.add('mine');
            mineGame.active = false;
            setTimeout(() => finishGame('mines', 'loss', 0), 1000);
        } else {
            el.innerText = 'üíé';
            el.classList.add('open');
            mineGame.opened++;
            mineGame.x = (mineGame.x * 1.45).toFixed(2);
            document.getElementById('mine-x').innerText = mineGame.x;
            document.getElementById('cashout-btn').disabled = false;
            tg.HapticFeedback.impactOccurred('light');
        }
    }

    function mineCashout() {
        if(!mineGame.active) return;
        mineGame.active = false;
        let win = Math.floor(100 * mineGame.x);
        finishGame('mines', 'win', win);
    }

    function finishGame(game, res, amt) {
        balance = balance - 100 + amt;
        document.getElementById('p-bal').innerText = balance;
        tg.sendData(JSON.stringify({ game, result: res, amount: amt }));
        setTimeout(() => tg.close(), 1000);
    }
</script>
</body>
</html>
